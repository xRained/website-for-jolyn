<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>For My Lovey, Jolyn</title>
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Montserrat:wght@300;400;600&display=swap" rel="stylesheet">
    
    <!-- Stylesheet -->
    <link rel="stylesheet" href="style.css">

    <!-- Leaflet.js for Maps -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />

    <!-- Leaflet Routing Machine for route planning -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet-routing-machine@latest/dist/leaflet-routing-machine.css" />
</head>
<body>

    <header>
        <nav>
            <div class="menu-toggle"></div>
            <ul class="nav-links">
                <li><a href="#about">About You</a></li>
                <li><a href="#gallery">Gallery</a></li>
                <li><a href="#notes">Love Notes</a></li>
                <li><a href="#timeline">Our Story</a></li>
                <li><a href="#location">Our Map</a></li>
                <li class="user-only"><a href="#sharing">Sharing</a></li>
                <li class="user-only"><a href="work.html">Work</a></li>
                <!-- Auth button is now part of the main nav list for better layout -->
                <li id="auth-container"><a href="#" id="login-button" class="cta-button">Login</a></li>
            </ul>
        </nav>
    </header>

    <main>
        <!-- Hero Section -->
        <section id="hero">
            <div class="hero-content">
                <h1>For My Loveys, Jolyn</h1>
                <p>A little corner of the internet dedicated to you.</p>
            </div>
        </section>

        <!-- About Her Section -->
        <section id="about" class="content-section">
            <h2 class="section-title">The One and Only</h2>
            <div class="about-content">
                <!-- Replace with a picture of her -->
                <img src="https://via.placeholder.com/250" alt="A beautiful picture of Jolyn" class="profile-pic">
                <!-- Replace with your own words about her -->
                <p>
                    From the moment we met, I knew you were special. This section is all about you—your kindness that brightens every room, your laugh that is my favorite sound, and the incredible way you make every day better just by being in it. You are more than I could have ever wished for.
                </p>
            </div>
        </section>

        <!-- Photo Gallery Section -->
        <section id="gallery" class="content-section">
            <h2 class="section-title">Our Moments</h2>
            <div class="gallery-grid">
                <!-- Photo gallery will be loaded here by JavaScript -->
            </div>
            <!-- Gallery Upload Button (user-only) -->
            <div class="upload-button-container user-only">
                <button id="open-upload-modal-button" class="cta-button">+ Add Moment</button>
            </div>
        </section>

        <!-- Love Notes Section -->
        <section id="notes" class="content-section">
            <h2 class="section-title">Little Love Notes</h2>
            <div class="notes-container">
                <!-- Love notes will be loaded here by JavaScript -->
            </div>
            <!-- New Note Form (user-only) -->
            <div id="add-note-form" class="add-form user-only">
                <textarea id="new-note-text" placeholder="Write a new love note..."></textarea>
                <button id="submit-note-button" class="cta-button small">Add Note</button>
            </div>
        </section>

        <!-- Relationship Timeline Section -->
        <section id="timeline" class="content-section">
            <h2 class="section-title">Our Story So Far</h2>
            <div class="timeline-container">
                <!-- Timeline events will be loaded here by JavaScript -->
            </div>
            <!-- New Timeline Event Form (user-only) -->
            <div id="add-timeline-form" class="add-form user-only">
                <input type="date" id="new-timeline-date">
                <input type="text" id="new-timeline-title" placeholder="Event Title (e.g., Our First Date)">
                <textarea id="new-timeline-desc" placeholder="A short description of the memory..."></textarea>
                <button id="submit-timeline-button" class="cta-button small">Add Event</button>
            </div>
        </section>

        <!-- Her Favorites Section -->
        <section id="favorites" class="content-section">
            <h2 class="section-title">A Few of Your Favorite Things</h2>
            <ul class="favorites-list">
                <!-- Favorites will be loaded here by JavaScript -->
            </ul>
            <!-- New Favorite Form (user-only) -->
            <div id="add-favorite-form" class="add-form user-only">
                <input type="text" id="new-favorite-text" placeholder="Add a new favorite thing...">
                <button id="submit-favorite-button" class="cta-button small">Add Favorite</button>
            </div>
        </section>

        <!-- Live Location Section -->
        <section id="location" class="content-section">
            <h2 class="section-title">Our Live Map</h2>
            <div class="map-container">
                <div id="map">
                    <!-- The map will be loaded here -->
                </div>
                <div id="route-info-box" style="display: none;">
                    <p>ETA: <strong id="route-eta"></strong> (<span id="route-distance"></span>)</p>
                </div>
                <div id="location-controls" class="user-only">
                    <div id="user-profile-area">
                        <img id="user-icon" src="https://via.placeholder.com/50" alt="Your Icon" class="profile-icon"/>
                        <div class="profile-info">
                            <p>Welcome, <span id="user-name"></span>!</p>
                            <label for="icon-upload" class="file-input-label small">Change Icon &rarr;</label>
                            <input type="file" id="icon-upload" accept="image/*" style="display: none;">
                            <p id="upload-status"></p>
                        </div>
                    </div>
                </div>
                <div class="location-notice-container">
                    <p id="location-notice-text" class="location-notice"></p>
                </div>
                <div class="location-buttons">
                    <button id="add-location-button" class="cta-button">Share Live Location</button>
                    <button id="stop-location-button" class="cta-button danger">Stop Sharing</button>
                </div>
            </div>
            <p class="location-notice guest-only">Login to start sharing your location and see our map!</p>
        </section>

        <!-- Sharing Section -->
        <section id="sharing" class="content-section user-only">
            <h2 class="section-title">Manage Access</h2>
            <p class="section-subtitle">Invite others to view and collaborate on your Work Hub.</p>
            <div class="sharing-container">
                <form id="add-member-form" class="add-form">
                    <input type="email" id="new-member-email" placeholder="Enter user's email to grant access" required>
                    <button id="submit-member-button" type="submit" class="cta-button small">Invite User</button>
                </form>
                <h3>Users with Access</h3>
                <p>These users can view and edit your content in the "Work" tab.</p>
                <div id="members-list-container"></div>
            </div>
        </section>

        <!-- Closing Message Section -->
        <section id="closing" class="content-section">
            <h2 class="section-title">Always and Forever</h2>
            <!-- Replace with your heartfelt closing message -->
            <p class="closing-message">
                Jolyn, you are my everything. This website is just a small token of my love for you. Every day with you is a gift, and I cherish every moment. Thank you for being you. I love you more than words can say.
            </p>
            <p class="signature">With all my love,</p>
            <!-- Replace with your name -->
            <p class="signature">Edrian</p>
        </section>
    </main>

    <footer>
        <p>Made with ❤️ for the one and only Jolyn.</p>
    </footer>

    <!-- Upload Modal (Moved here to fix layout issues) -->
    <div id="upload-modal" class="modal">
        <div class="modal-content">
            <span class="close-button">&times;</span>
            <h2>Upload a New Moment</h2>
            <div id="image-preview-container" style="display: none;">
                <img id="image-preview" src="#" alt="Image preview"/>
            </div>
            <label for="gallery-file-input" class="file-input-label">Choose a Photo</label>
            <input type="file" id="gallery-file-input" accept="image/*" style="display: none;">
            <button id="gallery-upload-button" class="cta-button">Upload Photo</button>
        </div>
    </div>

    <!-- Fullscreen Image Viewer Modal -->
    <div id="image-viewer-modal" class="modal">
        <span class="close-viewer-button">&times;</span>
        <img class="modal-image-content" id="fullscreen-image">
    </div>

    <!-- Login Options Modal -->
    <div id="login-modal" class="modal">
        <div class="modal-content">
            <span class="close-button">&times;</span>
            <h2>Choose Your Login</h2>
            <p>Select a provider to continue.</p>
            <div class="login-options-container">
                <button id="google-login-button" class="cta-button provider-button">Login with Google</button>
                <button id="github-login-button" class="cta-button provider-button">Login with GitHub</button>
            </div>
        </div>
    </div>

    <!-- Supabase SDK -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <!-- Leaflet.js (MUST be loaded before plugins) -->
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>

    <!-- Google Maps API (loaded asynchronously for performance) -->
    <!-- Note: Ad blockers might cause 'net::ERR_BLOCKED_BY_CLIENT' errors with this script. This is a client-side issue. -->
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCWKNVv3DGZZF2zLHxOx_KfjE__SKw1sXo" async></script>

    <!-- Leaflet Plugins (loaded AFTER Leaflet.js) -->
    <script src="https://unpkg.com/leaflet.gridlayer.googlemutant@latest/dist/Leaflet.GoogleMutant.js"></script>
    <script src="https://unpkg.com/leaflet-routing-machine@latest/dist/leaflet-routing-machine.js"></script>

    <script>
      // --- Supabase Configuration & Initialization ---
      // These are your public Supabase credentials
      const SUPABASE_CONFIG = { URL: "https://apolwnnlwkotsbxpubbv.supabase.co", ANON_KEY: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFwb2x3bm5sd2tvdHNieHB1YmJ2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQ0MDUzODQsImV4cCI6MjA3OTk4MTM4NH0.F5qZRmmwi0ylBuhBMeY1FPfyYcswm32dGHXtiALu9lE" };
      window.supabaseClient = supabase.createClient(SUPABASE_CONFIG.URL, SUPABASE_CONFIG.ANON_KEY);
    </script>

    <script src="script.js"></script>

</body>
</html>
